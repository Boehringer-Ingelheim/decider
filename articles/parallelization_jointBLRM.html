<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="decider">
<title>Parallelizing functions of the decider package • decider</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parallelizing functions of the decider package">
<meta property="og:description" content="decider">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">decider</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9012</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro_jointBLRM.html">Evaluate prior specifications of a joint BLRM for oncology dose finding</a>
    <a class="dropdown-item" href="../articles/parallelization_jointBLRM.html">Parallelizing functions of the decider package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Parallelizing functions of the decider package</h1>
            
      
      
      <div class="d-none name"><code>parallelization_jointBLRM.Rmd</code></div>
    </div>

    
    
<p>Four of the main functions of the decider package come with a
built-in parallelization using the <code>foreach</code> package, namely,
the functions:</p>
<ul>
<li><p><code><a href="../reference/scenario_list_jointBLRM.html">scenario_list_jointBLRM()</a></code> and
<code><a href="../reference/scenario_list_covariate_jointBLRM.html">scenario_list_covariate_jointBLRM()</a></code></p></li>
<li><p><code><a href="../reference/sim_jointBLRM.html">sim_jointBLRM()</a></code> and
<code><a href="../reference/sim_covariate_jointBLRM.html">sim_covariate_jointBLRM()</a></code></p></li>
</ul>
<p>Leveraging this capability requires the registration of a parallel
bakcend by the user. The present vignette will provide some basic
examples how such a backend can be registered. A similar vignette is
provided by the <a href="https://CRAN.R-project.org/package=bhmbasket" class="external-link"><code>bhmbasket</code></a>
package, which inspired the creation of the present vignette.</p>
<div class="section level2">
<h2 id="simple-parallelization">Simple parallelization<a class="anchor" aria-label="anchor" href="#simple-parallelization"></a>
</h2>
<p>First, the following packages are loaded</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Boehringer-Ingelheim.github.io/decider/">decider</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doFuture.futureverse.org" class="external-link">doFuture</a></span><span class="op">)</span></span></code></pre></div>
<p>With the <code>doFuture</code>, we register a simple parallel backend
with a given number of cores, set by the argument <code>n.cores</code>.
For the purpose of this vignette, we will use a single core due to
technical reasons, but when running the code locally, one can easily
change this depending on the number of cores available.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#specify number of cores -- here, only 1 for a sequential execution</span></span>
<span><span class="va">n.cores</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">#register backend for parallel execution and plan multisession</span></span>
<span><span class="fu">doFuture</span><span class="fu">::</span><span class="fu">registerDoFuture</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu">plan</span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va">multisession</span>, workers<span class="op">=</span><span class="va">n.cores</span><span class="op">)</span></span></code></pre></div>
<p>To figure out how many cores are available, one can use e.g.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>Following the initialization of the parallel backend, you can simply
run one of the four parallelized functions from the <code>decider</code>
package. They will automatically leverage the number of cores
registered.</p>
<p>As an example, a simple simulation could be accomplished by:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_jointBLRM.html">sim_jointBLRM</a></span><span class="op">(</span></span>
<span>  active.mono1.a <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  active.combi.a <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span></span>
<span>  doses.mono1.a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  doses.combi.a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>,  <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,  <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dose.ref1 <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  dose.ref2 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  start.dose.mono1.a <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  start.dose.combi.a1 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  start.dose.combi.a2 <span class="op">=</span> <span class="fl">1</span>,</span>
<span></span>
<span>  tox.mono1.a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  tox.combi.a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>,  <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>  max.n.mono1.a <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  max.n.combi.a <span class="op">=</span> <span class="fl">24</span>,</span>
<span>  cohort.size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  cohort.queue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  n.studies <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sim_result</span>, quote <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`results combi.a`</span></span>
<span><span class="co">#&gt;                              underdose target dose overdose max n reached before MTD all doses too toxic</span></span>
<span><span class="co">#&gt; Number of trials             0         0           0        0                        3                  </span></span>
<span><span class="co">#&gt; Percentage                   0         0           0        0                        100                </span></span>
<span><span class="co">#&gt; Percentage not all too toxic                                                                            </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`summary combi.a`</span></span>
<span><span class="co">#&gt;                     Median      Mean      Min. Max. 2.5%     97.5%</span></span>
<span><span class="co">#&gt; #Pat underdose   0.0000000 0.0000000 0.0000000    0 0.00 0.0000000</span></span>
<span><span class="co">#&gt; #Pat target dose 3.0000000 3.0000000 3.0000000    3 3.00 3.0000000</span></span>
<span><span class="co">#&gt; #Pat overdose    0.0000000 0.0000000 0.0000000    0 0.00 0.0000000</span></span>
<span><span class="co">#&gt; #Pat (all)       3.0000000 3.0000000 3.0000000    3 3.00 3.0000000</span></span>
<span><span class="co">#&gt; #DLT underdose   0.0000000 0.0000000 0.0000000    0 0.00 0.0000000</span></span>
<span><span class="co">#&gt; #DLT target dose 2.0000000 2.0000000 1.0000000    3 1.05 2.9500000</span></span>
<span><span class="co">#&gt; #DLT overdose    0.0000000 0.0000000 0.0000000    0 0.00 0.0000000</span></span>
<span><span class="co">#&gt; #DLT (all)       2.0000000 2.0000000 1.0000000    3 1.05 2.9500000</span></span>
<span><span class="co">#&gt; % overdose       0.0000000 0.0000000 0.0000000    0 0.00 0.0000000</span></span>
<span><span class="co">#&gt; % DLT            0.6666667 0.6666667 0.3333333    1 0.35 0.9833333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`MTDs combi.a`</span></span>
<span><span class="co">#&gt;                  2+1         4+1      8+1      2+2      4+2      8+2     </span></span>
<span><span class="co">#&gt; Dose             2+1         4+1      8+1      2+2      4+2      8+2     </span></span>
<span><span class="co">#&gt; True P(DLT)      0.3         0.4      0.6      0.4      0.5      0.7     </span></span>
<span><span class="co">#&gt; True category    target dose overdose overdose overdose overdose overdose</span></span>
<span><span class="co">#&gt; MTD declared (n) 0           0        0        0        0        0       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`#pat. combi.a`</span></span>
<span><span class="co">#&gt;             2+1 4+1 8+1 2+2 4+2 8+2</span></span>
<span><span class="co">#&gt; Dose        2+1 4+1 8+1 2+2 4+2 8+2</span></span>
<span><span class="co">#&gt; mean #pat   3   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; median #pat 3   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; min #pat    3   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; max #pat    3   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`#DLT combi.a`</span></span>
<span><span class="co">#&gt;             2+1 4+1 8+1 2+2 4+2 8+2</span></span>
<span><span class="co">#&gt; Dose        2+1 4+1 8+1 2+2 4+2 8+2</span></span>
<span><span class="co">#&gt; mean #DLT   2   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; median #DLT 2   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; min #DLT    1   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; max #DLT    3   0   0   0   0   0  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`results mono1.a`</span></span>
<span><span class="co">#&gt;                              underdose target dose overdose max n reached before MTD all doses too toxic</span></span>
<span><span class="co">#&gt; Number of trials                     0     1.00000        0                        0             2.00000</span></span>
<span><span class="co">#&gt; Percentage                           0    33.33333        0                        0            66.66667</span></span>
<span><span class="co">#&gt; Percentage not all too toxic         0   100.00000        0                        0                  NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`summary mono1.a`</span></span>
<span><span class="co">#&gt;                     Median      Mean Min.       Max.      2.5%      97.5%</span></span>
<span><span class="co">#&gt; #Pat underdose   0.0000000 0.0000000 0.00  0.0000000 0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; #Pat target dose 9.0000000 8.0000000 3.00 12.0000000 3.3000000 11.8500000</span></span>
<span><span class="co">#&gt; #Pat overdose    0.0000000 0.0000000 0.00  0.0000000 0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; #Pat (all)       9.0000000 8.0000000 3.00 12.0000000 3.3000000 11.8500000</span></span>
<span><span class="co">#&gt; #DLT underdose   0.0000000 0.0000000 0.00  0.0000000 0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; #DLT target dose 3.0000000 2.3333333 1.00  3.0000000 1.1000000  3.0000000</span></span>
<span><span class="co">#&gt; #DLT overdose    0.0000000 0.0000000 0.00  0.0000000 0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; #DLT (all)       3.0000000 2.3333333 1.00  3.0000000 1.1000000  3.0000000</span></span>
<span><span class="co">#&gt; % overdose       0.0000000 0.0000000 0.00  0.0000000 0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; % DLT            0.3333333 0.3055556 0.25  0.3333333 0.2541667  0.3333333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`MTDs mono1.a`</span></span>
<span><span class="co">#&gt;                  2           4           8       </span></span>
<span><span class="co">#&gt; Dose             2           4           8       </span></span>
<span><span class="co">#&gt; True P(DLT)      0.2         0.3         0.5     </span></span>
<span><span class="co">#&gt; True category    target dose target dose overdose</span></span>
<span><span class="co">#&gt; MTD declared (n) 1           0           0       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`#pat. mono1.a`</span></span>
<span><span class="co">#&gt;             2 4 8</span></span>
<span><span class="co">#&gt; Dose        2 4 8</span></span>
<span><span class="co">#&gt; mean #pat   5 3 0</span></span>
<span><span class="co">#&gt; median #pat 6 3 0</span></span>
<span><span class="co">#&gt; min #pat    3 0 0</span></span>
<span><span class="co">#&gt; max #pat    6 6 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`#DLT mono1.a`</span></span>
<span><span class="co">#&gt;             2                 4                8</span></span>
<span><span class="co">#&gt; Dose        2                 4                8</span></span>
<span><span class="co">#&gt; mean #DLT   0.666666666666667 1.66666666666667 0</span></span>
<span><span class="co">#&gt; median #DLT 1                 2                0</span></span>
<span><span class="co">#&gt; min #DLT    0                 0                0</span></span>
<span><span class="co">#&gt; max #DLT    1                 3                0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior</span></span>
<span><span class="co">#&gt;               mean       SD</span></span>
<span><span class="co">#&gt; mu_a1   -0.7081851 2.000000</span></span>
<span><span class="co">#&gt; mu_b1    0.0000000 1.000000</span></span>
<span><span class="co">#&gt; mu_a2   -0.7081851 2.000000</span></span>
<span><span class="co">#&gt; mu_b2    0.0000000 1.000000</span></span>
<span><span class="co">#&gt; mu_eta   0.0000000 1.121000</span></span>
<span><span class="co">#&gt; tau_a1  -1.3862944 0.707293</span></span>
<span><span class="co">#&gt; tau_b1  -2.0794415 0.707293</span></span>
<span><span class="co">#&gt; tau_a2  -1.3862944 0.707293</span></span>
<span><span class="co">#&gt; tau_b2  -2.0794415 0.707293</span></span>
<span><span class="co">#&gt; tau_eta -2.0794415 0.707293</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $specifications</span></span>
<span><span class="co">#&gt;                                  Value     -   </span></span>
<span><span class="co">#&gt; seed                             830451341 -   </span></span>
<span><span class="co">#&gt; dosing.intervals                 0.16      0.33</span></span>
<span><span class="co">#&gt; esc.rule                         ewoc      -   </span></span>
<span><span class="co">#&gt; esc.comp.max                     1         -   </span></span>
<span><span class="co">#&gt; dose.ref1                        8         -   </span></span>
<span><span class="co">#&gt; dose.ref2                        2         -   </span></span>
<span><span class="co">#&gt; saturating                       FALSE     -   </span></span>
<span><span class="co">#&gt; ewoc.threshold                   0.25      -   </span></span>
<span><span class="co">#&gt; start.dose.mono1.a               2         -   </span></span>
<span><span class="co">#&gt; esc.step.mono1.a                 2         -   </span></span>
<span><span class="co">#&gt; esc.constrain.mono1.a            FALSE     -   </span></span>
<span><span class="co">#&gt; max.n.mono1.a                    12        -   </span></span>
<span><span class="co">#&gt; cohort.size.mono1.a              3         -   </span></span>
<span><span class="co">#&gt; cohort.prob.mono1.a              1         -   </span></span>
<span><span class="co">#&gt; mtd.decision.mono1.a$target.prob 0.5       -   </span></span>
<span><span class="co">#&gt; mtd.decision.mono1.a$pat.at.mtd  6         -   </span></span>
<span><span class="co">#&gt; mtd.decision.mono1.a$min.pat     12        -   </span></span>
<span><span class="co">#&gt; mtd.decision.mono1.a$min.dlt     1         -   </span></span>
<span><span class="co">#&gt; mtd.decision.mono1.a$rule        2         -   </span></span>
<span><span class="co">#&gt; mtd.enforce.mono1.a              FALSE     -   </span></span>
<span><span class="co">#&gt; backfill.mono1.a                 FALSE     -   </span></span>
<span><span class="co">#&gt; backfill.size.mono1.a            3         -   </span></span>
<span><span class="co">#&gt; backfill.prob.mono1.a            1         -   </span></span>
<span><span class="co">#&gt; backfill.start.mono1.a           2         -   </span></span>
<span><span class="co">#&gt; start.dose.combi.a1              2         -   </span></span>
<span><span class="co">#&gt; start.dose.combi.a2              1         -   </span></span>
<span><span class="co">#&gt; esc.step.combi.a1                2         -   </span></span>
<span><span class="co">#&gt; esc.step.combi.a2                2         -   </span></span>
<span><span class="co">#&gt; esc.constrain.combi.a1           FALSE     -   </span></span>
<span><span class="co">#&gt; esc.constrain.combi.a2           FALSE     -   </span></span>
<span><span class="co">#&gt; max.n.combi.a                    24        -   </span></span>
<span><span class="co">#&gt; cohort.size.combi.a              3         -   </span></span>
<span><span class="co">#&gt; cohort.prob.combi.a              1         -   </span></span>
<span><span class="co">#&gt; mtd.decision.combi.a$target.prob 0.5       -   </span></span>
<span><span class="co">#&gt; mtd.decision.combi.a$pat.at.mtd  6         -   </span></span>
<span><span class="co">#&gt; mtd.decision.combi.a$min.pat     12        -   </span></span>
<span><span class="co">#&gt; mtd.decision.combi.a$min.dlt     1         -   </span></span>
<span><span class="co">#&gt; mtd.decision.combi.a$rule        2         -   </span></span>
<span><span class="co">#&gt; mtd.enforce.combi.a              FALSE     -   </span></span>
<span><span class="co">#&gt; backfill.combi.a                 FALSE     -   </span></span>
<span><span class="co">#&gt; backfill.size.combi.a            3         -   </span></span>
<span><span class="co">#&gt; backfill.prob.combi.a            1         -   </span></span>
<span><span class="co">#&gt; backfill.start.combi.a1          2         -   </span></span>
<span><span class="co">#&gt; backfill.start.combi.a2          1         -   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Stan options`</span></span>
<span><span class="co">#&gt;                 Value</span></span>
<span><span class="co">#&gt; chains            4.0</span></span>
<span><span class="co">#&gt; iter          13500.0</span></span>
<span><span class="co">#&gt; warmup         1000.0</span></span>
<span><span class="co">#&gt; adapt_delta       0.8</span></span>
<span><span class="co">#&gt; max_treedepth    15.0</span></span></code></pre></div>
<p>Here, only 3 studies are simulated for illustration purposes. Please
note, for simulations, one can also initiate storing and re-loading of
MCMC results to speed up simulations further when parallelizing on a
moderate number of cores (e.g., when one is not using a cluster). For
details, refer to the argument <code>working.path</code> of the function
<code><a href="../reference/sim_jointBLRM.html">sim_jointBLRM()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="parallelization-on-a-cluster">Parallelization on a cluster<a class="anchor" aria-label="anchor" href="#parallelization-on-a-cluster"></a>
</h2>
<p>All of the functions of the <code>decider</code> package that allow
for parallelization feature a nested <code>foreach</code> loop with two
stages. With this, is is possible to leverage the capabilities of
multiple cluster nodes that each have multiple cores. Usually,
simulations of joint BLRM trials with multiple arms will take a
relatively long run time (up to the order of hours) when executed on a
regular computer with a moderate amount of cores, so running simulations
on a cluster may be desirable to achieve manageable runtimes. Please
note that function <code>sim_jointBLRM</code> parallelizes across
trials, so, when simulating e.g. 1000 trials, multiple hundreds cores
can be used to substantially improve the run time.</p>
<p>In the following, it is illustrated how an exemplary parallel backend
on a common SLURM cluster could be registered. We will use the
<code>future.batchtools</code> package for this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.batchtools.futureverse.org" class="external-link">future.batchtools</a></span><span class="op">)</span></span></code></pre></div>
<p>Let us assume we have a cluster available where we want to request 10
nodes with 32 cores per node (320 cores in total). We specify this and
further ressources like the job time and memory requested in the
following arguments:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#number of processor nodes</span></span>
<span><span class="va">n_nodes</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co">#number of cores per node</span></span>
<span><span class="va">n_cpus</span>  <span class="op">&lt;-</span> <span class="fl">32</span></span>
<span><span class="co">#job time in hours</span></span>
<span><span class="va">walltime_h</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="co">#memory requested in GB</span></span>
<span><span class="va">memory_gb</span>  <span class="op">&lt;-</span> <span class="fl">4</span></span></code></pre></div>
<p>With this, we can allocate the parallel backend with the given
specifications:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slurm</span> <span class="op">&lt;-</span> <span class="fu">tweak</span><span class="op">(</span><span class="va">batchtools_slurm</span>,</span>
<span>               template  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'templates/slurm-simple.tmpl'</span>, package <span class="op">=</span> <span class="st">'batchtools'</span><span class="op">)</span>,</span>
<span>               workers   <span class="op">=</span> <span class="va">n_nodes</span>,</span>
<span>               resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                 walltime  <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="va">walltime_h</span>,</span>
<span>                 ncpus     <span class="op">=</span> <span class="va">n_cpus</span>,</span>
<span>                 memory    <span class="op">=</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">memory_gb</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#register paralel backend on cluster</span></span>
<span><span class="fu">registerDoFuture</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">slurm</span>, <span class="va">multisession</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>With this specification, when e.g. <code><a href="../reference/sim_jointBLRM.html">sim_jointBLRM()</a></code> is
called, the trials that need to be simulated will first be divided
evenly across the available nodes, and the trials to be simulated by
each node will be distributed across the CPUs the node has. In the above
example, when we simulate e.g. 6400 trials using 20 nodes with 32 cores
each, each node will receive 320 trials, which will be split across 32
cores, so that each core will need to simulate only 10 of the
trials.</p>
<p>After this setup, the <code><a href="../reference/sim_jointBLRM.html">sim_jointBLRM()</a></code> function can be
called in the same way as illustrated previously.</p>
<p>Please note that there are some tradeoffs involed depending on the
system, e.g. requesting a very large number of cores may take more
time.</p>
<p>At last, please note that the function <code><a href="../reference/sim_jointBLRM.html">sim_jointBLRM()</a></code>
also supports the use of a <code>working.path</code> argument which
allows to enable saving and reloading of MCMC results. If this is
executed on a parallel backend, please note that the path must be
somewhere in the shared memory, where all CPUs have access.
Synchronization across CPUs is carried out using file locks, which may
introduce some overhead. It was observed that this feature can
potentially still provide significant benefits to the runtime (both on a
cluster and on a standard computer), but please be aware that this is
<strong>highly experimental</strong>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lukas Schroeter, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
